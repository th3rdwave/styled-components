{"version":3,"file":"styled-components-macro.esm.js","sources":["../src/macro/index.ts"],"sourcesContent":["import { types } from '@babel/core';\nimport { addDefault, addNamed } from '@babel/helper-module-imports';\nimport traverse from '@babel/traverse';\nimport { createMacro, MacroParams } from 'babel-plugin-macros';\nimport babelPlugin from 'babel-plugin-styled-components';\n\nfunction styledComponentsMacro({\n  references,\n  state,\n  babel: { types: t },\n  config: { importModuleName = 'styled-components', ...config } = {},\n}: MacroParams) {\n  const program = state.file.path;\n\n  // FIRST STEP : replace `styled-components/macro` by `styled-components\n  // references looks like this\n  // { default: [path, path], css: [path], ... }\n  let customImportName;\n  Object.keys(references).forEach(refName => {\n    // generate new identifier\n    let id: types.Identifier;\n    if (refName === 'default') {\n      id = addDefault(program, importModuleName, { nameHint: 'styled' });\n      customImportName = id;\n    } else {\n      id = addNamed(program, refName, importModuleName, { nameHint: refName });\n    }\n\n    // update references with the new identifiers\n    references[refName].forEach(referencePath => {\n      // eslint-disable-next-line no-param-reassign\n      (referencePath.node as types.Identifier).name = id.name;\n    });\n  });\n\n  // SECOND STEP : apply babel-plugin-styled-components to the file\n  const stateWithOpts = {\n    ...state,\n    opts: {\n      ...config,\n      topLevelImportPaths: (config.topLevelImportPaths || []).concat(importModuleName),\n    },\n    customImportName,\n  };\n  traverse(program.parent, babelPlugin({ types: t }).visitor, undefined, stateWithOpts);\n}\n\nexport default createMacro(styledComponentsMacro, {\n  configName: 'styledComponents',\n});\n"],"names":["createMacro","_a","customImportName","references","state","t","_b","_c","_d","importModuleName","config","program","file","path","Object","keys","forEach","refName","id","addDefault","nameHint","addNamed","referencePath","node","name","stateWithOpts","opts","topLevelImportPaths","concat","traverse","parent","babelPlugin","types","visitor","undefined","configName"],"mappings":"oPA+CA,MAAeA,GAzCf,SAA+BC,GAC7B,IAUIC,EAVJC,eACAC,UACgBC,gBAChBC,WAAAC,aAAgE,KAAtDC,qBAAAC,aAAmB,sBAAwBC,MAA7C,sBAEFC,EAAUP,EAAMQ,KAAKC,KAM3BC,OAAOC,KAAKZ,GAAYa,SAAQ,SAAAC,GAE9B,IAAIC,EACY,YAAZD,GACFC,EAAKC,EAAWR,EAASF,EAAkB,CAAEW,SAAU,WACvDlB,EAAmBgB,GAEnBA,EAAKG,EAASV,EAASM,EAASR,EAAkB,CAAEW,SAAUH,IAIhEd,EAAWc,GAASD,SAAQ,SAAAM,GAEzBA,EAAcC,KAA0BC,KAAON,EAAGM,WAKvD,IAAMC,SACDrB,IACHsB,YACKhB,IACHiB,qBAAsBjB,EAAOiB,qBAAuB,IAAIC,OAAOnB,KAEjEP,qBAEF2B,EAASlB,EAAQmB,OAAQC,EAAY,CAAEC,MAAO3B,IAAK4B,aAASC,EAAWT,KAGvB,CAChDU,WAAY"}